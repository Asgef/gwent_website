---
- hosts: webservers
  gather_facts: no
  vars:
    user: "{{ ansible_user }}"
    project_name: gwent_website

  tasks:
    - name: Ensure the latest code is pulled from GitHub
      git:
      # 
        repo: "https://github.com/Asgef/{{ project_name }}.git"
        dest: "/home/{{ user }}/{{ project_name }}"
        version: main
        update: yes

    - name: Install project
      ansible.builtin.shell: bash -lc "make install"
      args:
        chdir: "/home/{{ user }}/{{ project_name }}"

    - name: Build project
      ansible.builtin.shell: bash -lc "make build"
      args:
        chdir: "/home/{{ user }}/{{ project_name }}"

    - name: Restart project
      ansible.builtin.shell: bash -lc "make restart-production"
      args:
        chdir: "/home/{{ user }}/{{ project_name }}"
